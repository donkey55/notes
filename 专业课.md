# 计算机网络

## 数据链路层

### 3.3 基本数据链路协议

#### 无限制的单工协议：

- 单向传输
- 理想信道
- 发送方总有数据发送
- 接收方总能及时处理所收到的数据

#### 单工停-等协议

按照“无限制的单工协议”，如果接收方处理帧的速度不及发 送方，则帧可能丢失。

**解决方法**：无限制单工协议增加**流量控制机制**：

* 接收方每次收到一帧，都向发送方返回一个应答帧。
* 发送方每发送一帧，都等待来自接受方的应答帧，之后才发送下一帧。

#### 有噪声信道的单工协议

> 在有噪声的信道中，帧传输过程中可能出错。

**解决方法**：---ARQ（Automatic Repeat reQuest）协议

* 校验和：使接收方能够检测帧是否出错
* 确认帧：使发送方知道帧已经被正确接收
* 超时重发：发送方在规定时间内未收到确认帧，则重发帧
* 帧序号：保证接收方不会重复接收帧

**协议设计需考虑的三种情形：**

* 数据帧被正确接收：接收方返回确认帧，发送发收到后继续发送下一帧。
* 数据帧出错或丢失：接收方未收到帧或校验出错丢弃该帧，发送方等待确认帧超时后，重发数据帧。
* 确认帧出错或丢失：发送方未收到有效的确认帧，重发数据帧，接收方收到后，检查帧序号重复，不上交该帧，只返回确认帧。

### 3.4 滑动窗口协议

窗口移动过程和TCP窗口移动过程类似。

但当帧出错时有两种处理方式：

- 出错帧后的帧丢弃，从出错帧开始重新发送（➡️**后退N帧**）
- 出错帧后的帧保留，只重发出错帧(➡️选择性重传)

### 3.5 点对点协议PPP

PPP的透明传输问题

同步传输：零比特填充解决。

异步传输：字符填充。

同步传输（一连串的比特连续传送）异步传输（逐个字符地传送）。

### 3.6 介质访问控制（Media Access Control）

为何？局域网内一般使用广播信道，而通过静态的划分信道，代价较高（频分复用、时分复用、波分复用、码分复用），不适合局域网使用。动态媒体接入控制，即共享信道，分为随机访问和受控访问。随机访问包括CSMA/CD协议。

#### CSMA/CD协议

全称：**Carrier Sense Multiple Access with Collision Detection**  **载波监听多点访问/碰撞检测**

是一种随机访问协议。

* 载波监听
* 碰撞检测
* 碰撞强化
* 碰撞退避

## 网络层

### 为什么使用IP地址？

由于全世界存在着各式各样的网络，它们使用不同的硬件地址。要使这些异构网络能 够互相通信就必须进行非常复杂的硬件地址转换工作，因此由用户或用户主机来完成这项 工作几乎是不可能的事。但 IP 编址把这个复杂问题解决了。连接到互联网的主机只需各 自拥有一个唯一的 IP 地址，它们之间的通信就像连接在同一个网络上那样简单方便，因 为上述的调用 ARP 的复杂过程都是由计算机软件自动进行的，对用户来说是看不见这种 调用过程的。 因此，在虚拟的 IP 网络上用 IP 地址进行通信给广大的计算机用户带来很大的方便

# 计算机组成原理

## Cache

### whatever

* Cache主要解决系统速度，而虚拟存储器是为了解决主存容量。

### Cache写策略

#### 命中

* **全写法（写直通法，write-through）**。命中时，将内容同时写到Cache和主存中。
* **写回法（write-back）**。命中时，直接对Cache块进行修改，而不写回主存，在Cache块被换出时，写回主存。

#### 未命中

* **写分配法（write-allocate）**。缺失时，加载主存中的块到Cache中，然后更新这个Cache块。
* **非写分配法（not-write-allocate）**。缺失时，只写回到主存中，不再进行调主存块到Cache中。

全写法通常与全写法合用，写回法通常与写分配法合用。

### 指令系统

#### 数据寻址方式

* 立即数寻址
* 寄存器直接寻址，数据存储在寄存器中。
* 寄存器间接寻址，数据的地址存储在寄存器中。
* 基址寻址。lw s1   s2(100)
* 变址寻址。
* 相对寻址。beq s1 s2 100
* 堆栈寻址。即SP

### 总线

#### 总线结构

* 单总线结构。CPU、主存、IO设备（IO接口）公用一组总线
* 双总线结构。分为主存总线和IO总线。CPU、主存、通道通过主存总线进行通信，通道和IO设备（IO接口）之间通过IO总线进行通信。
* 三总线结构。分为主存总线、IO总线和DMA总线。CPU和主存通过主存总线进行通信，主存可以与外设通过DMA总线来直接进行数据传送，CPU通过IO总线和IO接口进行通信

#### 总线仲裁

* 集中仲裁。
  * 链式查询。公用同一条总线请求（BR），需要的设备通过BR向总线控制部件发送请求，总线控制部件判断当前总线是否忙，不忙时，将总线应答信号，通过总线应答线（BG）发送，BG是串联在各个设备之间的，优先级固定，从前到后，遇到需要总线的设备，便被拦截，不再传递。
  * 计数器定时查询。计时器定时，通过一条新的设备地址线将计数器的值传递，当计数器的值与设备地址相同，设备发出总线忙信号，计数器不再定时。
  * 独立请求。每一个设备都有单独的BR与BG，优先级在总线控制器中实现。

#### 总线传输

过程：

* 请求总线
* 总线仲裁
* 寻址
* 信息传送
* 结束阶段。将该请求模块的信息从系统总线上撤销，让出总线使用权。

协调通信双方，同步定时方式：

* 同步定时。采用统一的时钟信号来协调发送和接收方的传送定时。
* 异步定时。
  * 不互锁。主设备请求发出之后，一段时间撤销，从设备接收到请求后，发送应答请求，一段时间撤销
  * 半互锁。主设备必须等到从设备应答之后，才可以撤销，从设备发出应答请求后，一段时间自行撤销。
  * 全互锁。主设备等到从设备应答之后才可以撤销请求，从设备等到主设备撤销请求后，才可以撤销应答。

![image-20211120233423235](C:\Users\lsp\AppData\Roaming\Typora\typora-user-images\image-20211120233423235.png)

### 输入/输出系统

#### 概念

* **I/O接口**：在各个外设与主机之间传输数据时进行各种协调工作的逻辑部件。协调包括传输过程中速度的匹配、电平和格式转换等。
* **外存设备**：指除计算机内存及CPU缓存等外的存储器。比如硬盘、光盘等。

一般来说IO系统由IO软件和IO硬件组成。

* **IO软件**：包括驱动程序、用户程序、管理程序、升级补丁等。通常采用 **IO指令**和 **通道指令** 实现CPU与IO设备的信息交换。其中IO指令是由CPU执行，通道指令存储在内存中，由通道执行。
* **IO硬件**：包括外部设备、设备控制器和接口、IO总线等。

#### 外存储器

* 磁盘存储器。一块硬盘由若干记录面，每一个记录面划分为若干磁道，每条磁道划分为若干扇区，扇区也称为块是磁盘读写最小单位。

#### IO接口

**IO端口**是指IO接口电路中可以进行读/写的寄存器，若干端口加上IO控制逻辑组成IO接口。

#### IO端口的编址

IO端口一般通过IO指令进行访问，CPU想要访问IO端口就需要对各个端口进行编号。端口编址的方式有两种：

* 统一编址。又称存储器映射方式。把IO端口当作存储器单元进行地址分配，优点在于**不需要单独设计IO指令**，通过统一的访存指令就可访问。缺点：速度慢，内存容量变小。
* 独立编址。又称IO映射方式。IO端口地址空间是独立的。需要单独设计IO指令，需要CPU提供存储器读写的基础上增加对IO设备读写的控制信号，增加了控制的复杂性。

#### IO方式

##### 程序查询方式

##### 程序中断方式

异常：异常是CPU内部引起的意外事件。分为硬故障中断和程序性异常：

* 硬故障中断由硬连线出现异常引起的。如电源掉电、存储器线路出错等。
* 程序性异常也称**软中断**，是指在CPU内部因执行指令而引起的异常事件。如整除0溢出、断点、非法指令、栈溢出、地址越界、缺页、分时系统中的时间片中断及用户态到核心态的切换等。

按照发生异常的报告方式和返回方式的不同，内部异常可分为**故障（Fault）**、**自陷（trap）**和**终止（Abrot）**。

**DMA方式**

# 操作系统

